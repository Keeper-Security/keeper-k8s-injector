# NetworkPolicy to simulate Keeper API outage
#
# Blocks egress traffic to keepersecurity.com
# Used to test cache fallback behavior

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: block-keeper-api
  namespace: default
spec:
  podSelector:
    matchLabels:
      app: resilience-demo
  policyTypes:
  - Egress
  egress:
  # Allow DNS
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: UDP
      port: 53

  # Allow internal cluster traffic
  - to:
    - podSelector: {}
    ports:
    - protocol: TCP

  # Block everything else (including keepersecurity.com)
  # This simulates Keeper API being unreachable
